server:
  port: 9001
  http2:
    enabled: true

custom-props:
  home-protocol: http
  home-url: stayeaze
  local-server: ${custom-props.home-protocol}://${custom-props.home-url}:${server.port} 
  admin-discovery-server: ${custom-props.home-protocol}://stayeaze:8091
  log-file-root: C:\\logs

spring:
  boot:
    admin:
      client:
        url: http://stayeaze:8091/spring-admin/   # URL of your Admin Server
        instance:
          service-url: http://stayeaze:${server.port}  # ensure Admin knows how to call back
  cloud:
    gateway:
      httpclient:
        pool:
          max-idle-time: 10000
      x-forwarded:
        for-enabled: true
        prefix-enabled: true
        host-enabled: true
        port-enabled: true
        proto-enabled: true
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOriginPatterns:
              - "*"
            allowedHeaders: "*"
            allowedMethods: "*"           # ← Allows all HTTP methods
            allowCredentials: true
            maxAge: 1800
            exposedHeaders: # ← Often needed for custom headers
              - "*"
              
      routes:
        - id: business-booking-places
          uri: http://stayeaze:9003
          predicates:
            - Path=/businessCompany/places/**
            - Method=GET
          filters:
            - name: ExceptionCaptureFilter
            - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
            - name: CircuitBreaker
              args:
                name: fallbackcmd
                fallbackUri: forward:/serviceNotAvailable
        - id: business-booking
          uri: http://stayeaze:9003
          predicates:
            - Path=/businessCompany/**
          filters:
            - name: RateLimitFilter
              args:
                requestsPerMinute: 50
            - name: ExceptionCaptureFilter
            - JwtAuthenticationFilter
            - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
            - name: CircuitBreaker
              args:
                name: fallbackcmd
                fallbackUri: forward:/serviceNotAvailable
        - id: auth-service-public
          uri: http://stayeaze:9002
          predicates:
            - Path=/auth/register, /auth/login, /auth/health
          filters:
            - name: ExceptionCaptureFilter
            - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
            - name: CircuitBreaker
              args:
                name: fallbackcmd
                fallbackUri: forward:/serviceNotAvailable
        - id: auth-service-protected
          uri: http://stayeaze:9002
          predicates:
            - Path=/auth/logout, /auth/refresh
          filters:
            - JwtAuthenticationFilter
            - name: ExceptionCaptureFilter
            - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
            - name: CircuitBreaker
              args:
                name: fallbackcmd
                fallbackUri: forward:/serviceNotAvailable





management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always

hystrix:
  threadpool:
    default:
      allowMaximumSizeToDivergeFromCoreSize: true
      maximumSize: 50
  command:
    fallbackcmd:
      circuitBreaker: 
        enabled: false
      execution:
        isolation:
          strategy: THREAD
          thread:
            timeoutInMilliseconds: 300000
    fallbackcmd-auth:
      circuitBreaker:
        enabled: false
      execution:
        isolation:
          strategy: THREAD
          thread:
            timeoutInMilliseconds: 300000
            
            
resilience4j.circuitbreaker:
    instances:
        fallbackcmd:
            registerHealthIndicator: true
            slidingWindowSize: 10
            permittedNumberOfCallsInHalfOpenState: 3
            slidingWindowType: TIME_BASED
            minimumNumberOfCalls: 20
            waitDurationInOpenState: 50s
            failureRateThreshold: 50
            eventConsumerBufferSize: 10  
        fallbackcmd-auth:
            registerHealthIndicator: true
            slidingWindowSize: 10
            permittedNumberOfCallsInHalfOpenState: 3
            slidingWindowType: TIME_BASED
            minimumNumberOfCalls: 20
            waitDurationInOpenState: 50s
            failureRateThreshold: 50
            eventConsumerBufferSize: 10       
resilience4j.timelimiter:
    instances:
        fallbackcmd:
            timeoutDuration: 90s
            cancelRunningFuture: true 
        fallbackcmd-auth:
            timeoutDuration: 90s
            cancelRunningFuture: true            
            
debug: true
# ----------------------------------------
# LOGGING PROPERTIES FOR LOGBACK IMPLIMENTATION
# Reference URL https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html
# ----------------------------------------
logging:
  level:
    org:
      springframework: DEBUG
    reactor:
      netty: DEBUG
    redisratelimiter: DEBUG
    com: 
      uniteller: DEBUG
      netflix.hystrix: DEBUG 
  file:
    name: ${custom-props.log-file-root}/business-${spring.application.name}.log
    
    
eureka:
  client:
    instance:
      hostname: stayeaze
      instanceId: ${spring.application.name}:${vcap.application.instance_id:${spring.application.instance_id:${random.value}}}
    serviceUrl:
      defaultZone: ${custom-props.admin-discovery-server}/eureka/ #Map of availability zone to list of fully qualified URLs to communicate with eureka server. Each value can be a single URL or a comma separated list of alternative locations. Typically the eureka server URLs carry protocol,host,port,context and version information if any. Example: http://stayeaze:8081/eureka/ The changes are effective at runtime at the next service url refresh cycle as specified by eurekaServiceUrlPollIntervalSeconds.
    register-with-eureka: true #Indicates whether or not this instance should register its information with eureka server for discovery by others. In some cases, you do not want your instances to be discovered whereas you just want do discover other instances. (default true)
    fetch-registry: true    

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:mySecretKeyForJWTTokenGenerationThatShouldBeAtLeast256BitsLongsdoijfsdfuiosdjfsdf34534534534gfergfedfvdfgdfgdfgdfgv345345345345345}
  access-token-expiration: 3600000    # 1 hour in milliseconds
  refresh-token-expiration: 604800000  # 7 days in milliseconds
  issuer: auth-service